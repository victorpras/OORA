<!DOCTYPE html>
 
<html lang="en">
<head>
<title>Order</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
<script src="/nowjs/now.js"></script>

<script>
$(document).ready(function() {
  now.receiveMessage = function(name, message) {
    $("#messages").append("<br>" + name + message);
  }
  $("#send-button").click(function() {
    now.distributeMessage($("#text-input").val());
    $("#text-input").val("");
  });
  now.name = prompt("What's your name?", "");
  // on establishing 'now' connection, set server restaurant and allow message sending
  now.ready(function(){
    // Pick up list of available restaurant from server and populate dropdown 
    setRestaurantFromList(now.restaurantList);

    // Pick up list of available menu from server and populate dropdown
    setMenuFromList(now.menuList);
 		
    // By default pick the first restaurant 
    now.changeRestaurant($('#server-restaurant').val());

    // By default pick the first menu
    now.changeMenu($('#server-menu').val());

    // Connection established and restaurant set; allow costumer to start sending orders
    $("#send-button").removeAttr('disabled');
  });

  // Change of drop down restaurant
  $('#server-restaurant').change(function() {
    $("#messages").html('');
    now.changeRestaurant($('#server-restaurant').val());
  });

  // Change of drop down menu
  $('#server-menu').change(function() {
    now.changeMenu($('#server-menu').val());
  });
});

//populate the #server-menu dropdown
function setMenuFromList(mList) {
  $('#server-menu').empty();
  $.each(mList, function(key, value)
  {
    $('#server-menu').
    append($("<option></option>").
    attr("value",key).
    text(value));
  });
}	

// populate the #server-restaurant dropdown 
function setRestaurantFromList(restList) {
  $('#server-restaurant').empty();
  $.each(restList, function(key, value)
  {   
    $('#server-restaurant').
    append($("<option></option>").
    attr("value",key).
    text(value)); 
  });
}
</script>
</head>
<body>
  <div id="messages"></div>
  <input type="text" id="text-input">
  <select id="server-menu">
    <option value="connecting" selected>Connecting...</option>	
  </select>
  <input type="submit" value="Order" disabled id="send-button">
  <select id="server-restaurant">
    <option value="connecting" selected>Connecting...</option>
  </select>   
</body>
</html>
